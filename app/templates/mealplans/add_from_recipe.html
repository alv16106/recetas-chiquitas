{% extends "base.html" %}

{% block title %}Añadir a plan - {{ recipe.title }}{% endblock %}

{% block content %}
<h1>Añadir receta a plan de comidas</h1>
<p>Receta: <strong>{{ recipe.title }}</strong></p>

<form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="mb-3">
        <div class="form-check">
            <input class="form-check-input" type="radio" name="mode" id="mode_existing" value="existing" checked
                   onchange="document.getElementById('plan_select').disabled=false; document.getElementById('new_name').disabled=true; document.getElementById('duration_days').disabled=true;">
            <label class="form-check-label" for="mode_existing">Añadir a plan existente</label>
        </div>
        <select name="plan_id" id="plan_select" class="form-select mt-2">
            <option value="">-- Selecciona un plan --</option>
            {% for mp in plans %}
            <option value="{{ mp.id }}">{{ mp.name }} ({{ mp.duration_days }} días)</option>
            {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <div class="form-check">
            <input class="form-check-input" type="radio" name="mode" id="mode_new" value="new"
                   onchange="document.getElementById('plan_select').disabled=true; document.getElementById('new_name').disabled=false; document.getElementById('duration_days').disabled=false;">
            <label class="form-check-label" for="mode_new">Crear nuevo plan</label>
        </div>
        <input type="text" class="form-control mt-2" name="new_plan_name" id="new_name" placeholder="Nombre del nuevo plan" disabled>
        <input type="number" class="form-control mt-2" name="duration_days" id="duration_days" placeholder="Duración en días (opcional, por defecto 7)" min="1" disabled>
    </div>

    <input type="hidden" name="create_new" id="create_new" value="0">

    <button type="submit" class="btn btn-primary">Añadir al plan</button>
    <a href="{{ url_for('recipes.detail', id=recipe.id) }}" class="btn btn-secondary">Cancelar</a>
</form>

<script>
document.querySelector('form').addEventListener('submit', function(e) {
    const modeNew = document.getElementById('mode_new').checked;
    document.getElementById('create_new').value = modeNew ? '1' : '0';
    if (modeNew && !document.getElementById('new_name').value.trim()) {
        e.preventDefault();
        alert('Ingresa el nombre del nuevo plan.');
        return false;
    }
    if (!modeNew && !document.getElementById('plan_select').value) {
        e.preventDefault();
        alert('Selecciona un plan.');
        return false;
    }
});
</script>
{% endblock %}

