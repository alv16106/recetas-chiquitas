{% extends "base.html" %}

{% block title %}{{ shopping_list.name }} - Recetas Chiquitas{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ shopping_list.name }}</h1>
    <div>
        <a href="{{ url_for('shopping.edit', id=shopping_list.id) }}" class="btn btn-outline-primary">Editar</a>
        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">Eliminar</button>
    </div>
</div>

<form method="post" action="{{ url_for('shopping.edit', id=shopping_list.id) }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <ul class="list-group">
        {% for item in shopping_list.items %}
        <li class="list-group-item d-flex align-items-center">
            <div class="form-check me-3">
                <input class="form-check-input" type="checkbox" name="checked_{{ item.id }}" id="check_{{ item.id }}"
                       {% if item.checked %}checked{% endif %}
                       onchange="this.form.submit()">
                <label class="form-check-label" for="check_{{ item.id }}">
                    {% set iname = item.ingredient.name if item.ingredient else item.ingredient_name %}
                    {% set ustr = (item.unit_obj.symbol or item.unit_obj.name) if item.unit_obj else item.unit %}
                    {% if item.quantity or ustr %}
                    <strong>{{ item.quantity }} {{ ustr }}</strong> {{ iname }}
                    {% else %}
                    {{ iname }}
                    {% endif %}
                </label>
            </div>
        </li>
        {% endfor %}
    </ul>
    {% if shopping_list.items.count() > 0 %}
    <button type="submit" class="btn btn-primary mt-2">Guardar cambios</button>
    {% endif %}
</form>

{% if shopping_list.items.count() == 0 %}
<p class="text-muted">La lista está vacía. Añade ingredientes desde una receta.</p>
{% endif %}

<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Eliminar lista</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                ¿Seguro que quieres eliminar "{{ shopping_list.name }}"?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <form action="{{ url_for('shopping.delete', id=shopping_list.id) }}" method="post" class="d-inline">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-danger">Eliminar</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
